"use strict";angular.module("fusionTablesToolApp1",[]);var queryApp=angular.module("fusionTablesToolApp",["ui.bootstrap"]);queryApp.controller("AutorisationController",["$scope","$rootScope",function(a,b){a.startAutorisation=function(){var a={client_id:"920556103207-4abh9v79e77viiibilqfelh6p7dd7fim.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/fusiontables"};gapi.auth.authorize(a,function(){console.log("login complete"),console.log(gapi.auth.getToken()),gapi.client.load("fusiontables","v1",function(){console.log("sending event"),$("#authModal").modal("hide"),b.$emit("autorisationSuccess")})})}}]),queryApp.controller("QueryController",["$scope","$rootScope",function(a,b){a.maxSize=10,a.currentPage=1,a.totalItems=0,a.alert=null,a.runQuery=function(){a.alert=null;var b=gapi.client.fusiontables.query.sql({sql:a.query});$("#pleaseWaitDialog").modal("show"),b.execute(function(b){return console.log(b),a.totalItems=0,a.queryResult=b,"undefined"!=typeof a.queryResult.code?void c("danger",a.queryResult.message):"undefined"==typeof a.queryResult.rows?void c("info","No rows where returned as a result of the query"):(a.totalItems=a.queryResult.rows.length,a.$apply(),void $("#pleaseWaitDialog").modal("hide"))})};var c=function(b,c){a.alert={},a.alert.type=b,a.alert.text=c,a.$apply()},d=b.$on("updateQuery",function(b,c){console.log("updateQuery recieved"),a.query=c,a.runQuery()});a.$on("$destroy",d)}]),queryApp.controller("TableInfoController",["$scope","$rootScope",function(a,b){a.tableClicked=function(d){console.log("updateQuery sent, id: "+a.tableInfo.items),console.log("updateQuery sent, id: "+a.tableInfo.items[d].tableId),console.log("updateQuery sent, index: "+d),b.$emit("updateQuery","SELECT * FROM "+a.tableInfo.items[d].tableId+" LIMIT 10"),c(d)};var c=function(b){a.tableInfo.items.splice(0,0,a.tableInfo.items.splice(b,1)[0])},d=b.$on("autorisationSuccess",function(){console.log("autorisationSuccess recieved");var b=gapi.client.fusiontables.table.list();b.execute(function(b){console.log("tables loaded"),console.log(b),a.tableInfo=b,a.$apply()})});a.$on("$destroy",d)}]);